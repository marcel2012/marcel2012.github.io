<!DOCTYPE html>
<html>
  <head>
    <title></title>
	<meta charset="UTF-8">
	<style>
		body,html
		{
			width:100%;
			height:100%;
			margin:0;
			padding:0;
			border:0;
			background:linear-gradient(#81AD3E,#81AD3E);
			color:#fff;
			font-size:15px;
		}
		input
		{
			background:rgba(255,255,255,0.1);
			width:200px;
			outline:none;
			border-width:0;
			color:#fff;
			padding:2px 15px;
		}
		input[type=submit]
		{
			margin-left:100px;
		}
		.opcje
		{
			background:rgba(0,0,0,0.9);
			width:90%;
			padding:2% 5%;
		}
		.opcje td
		{
			width:200px;
		}
		.dana
		{
			width:100%;
		}
		canvas
		{
			background:#fff;
			border: 1px solid #000;
			margin:auto;
			position:relative;
			display:block;
		}
		#dane
		{
			background:#fff;
			border: 1px solid #000;
			width:880px;
			min-height:80px;
			overflow-y:auto;
			padding:10px;
			color:#000;
			margin:auto;
		}
		.dane
		{
			background:#fff;
			border: 1px solid #000;
			width:880px;
			height:150px;
			overflow-y:auto;
			padding:10px;
			color:#000;
			margin:auto;
		}
	</style>
	<script>
		var c_width;
		var c_height;
		window.onload=function()
		{
			c_width=window.innerWidth*0.9;
			c_height=window.innerHeight-400;;
			document.getElementById("canvas").style.width=c_width+"px";
			document.getElementById("canvas").style.height=c_height+"px";
			document.getElementById("canvas").width=c_width;
			document.getElementById("canvas").height=c_height;
			document.getElementById("dane").style.width=c_width-20+"px";
			document.getElementsByClassName("dane")[0].style.width=c_width-20+"px";
		}
		function R(min,max)
		{
			return Math.min(parseInt(Math.random()*(max-min+1))+min,max);
		}
		function drzewo(n /*liczba wierzchołków*/,
						d /*maksymalna liczba dzieci*/)
		{
			wierzcholek=[];
			wierzcholek[0]={};
			wierzcholek[0].dziecko=[];
			wierzcholek[0].rodzic=0;
			wierzcholek[0].lewa=0;
			for(i=1;i<n;i++)
			{
				wierzcholek[i]={};
				wierzcholek[i].dziecko=[];
				do
				{
					r=R(0,i-1);
				}
				while(wierzcholek[r].dziecko.length>=d);
				wierzcholek[i].rodzic=r;
				wierzcholek[r].dziecko[wierzcholek[r].dziecko.length]=i;
			}
			return wierzcholek;
		}
		function graf(n /*liczba wierzchołków*/,
						m /*liczba krawędzi*/)
		{
			wierzcholek=[];
			for(i=0;i<n;i++)
			{
				wierzcholek[i]={};
				wierzcholek[i].sasiad=[];
			}
			for(i=0;i<m;i++)
			{
				do
				{
					r1=R(0,n-1);
					r2=R(0,n-1);
				}
				while(wierzcholek[r1].sasiad.indexOf(r2)!=-1 || r1==r2);
				wierzcholek[r1].sasiad[wierzcholek[r1].sasiad.length]=r2;
				wierzcholek[r2].sasiad[wierzcholek[r2].sasiad.length]=r1;
			}
			return wierzcholek;
		}
		function generuj_drzewo(typ /*0 losowe, 1 binarne*/,
								n /*liczba wierzchołków*/)
		{
			switch (typ)
			{
				case 0:
					return drzewo(n,n);
				break;
				case 1:
					return drzewo(n,2);
				break;
			}
			
		}
		function generuj_graf(typ /*0 losowy, 1 pełny*/,
								n /*liczba wierzchołków*/,
								spojne /*sprawdź spójność*/)
		{
			switch (typ)
			{
				case 0:
					return graf(n,n);
				break;
				case 1:
					return graf(n,n*(n-1)/2);
				break;
			}
			
		}
		function szerokosc_dfs(wierzcholek,start)
		{
			wierzcholek[start].szerokosc=0;
			wierzcholek[start].i=0;
			for(;wierzcholek[start].i<wierzcholek[start].dziecko.length;wierzcholek[start].i++)
				wierzcholek[start].szerokosc+=szerokosc_dfs(wierzcholek,wierzcholek[start].dziecko[wierzcholek[start].i]);
			if(wierzcholek[start].szerokosc==0)
				wierzcholek[start].szerokosc++;
			return wierzcholek[start].szerokosc;
		}
		function rysuj_dfs(wierzcholek,start,szerokosc,glebokosc,poziom)
		{
			wierzcholek[start].lewa=wierzcholek[wierzcholek[start].rodzic].lewa;
			wierzcholek[start].i=0;
			wierzcholek[start].y=poziom;
			wierzcholek[start].x=parseFloat(wierzcholek[start].lewa+1.0*wierzcholek[start].szerokosc/2);
			for(;wierzcholek[start].i<wierzcholek[start].dziecko.length;wierzcholek[start].i++)
			{
				rysuj_dfs(wierzcholek,wierzcholek[start].dziecko[wierzcholek[start].i],szerokosc,glebokosc,poziom+1);
				wierzcholek[start].lewa+=wierzcholek[wierzcholek[start].dziecko[wierzcholek[start].i]].szerokosc;
			}
		}
		function glebokosc_dfs(wierzcholek,start)
		{
			wierzcholek[start].glebokosc=0;
			wierzcholek[start].i=0;
			for(;wierzcholek[start].i<wierzcholek[start].dziecko.length;wierzcholek[start].i++)
				wierzcholek[start].glebokosc=Math.max(wierzcholek[start].glebokosc,glebokosc_dfs(wierzcholek,wierzcholek[start].dziecko[wierzcholek[start].i]));
			return wierzcholek[start].glebokosc+1;
		}
		function szerokosc_grafu(wierzcholek)
		{
			return szerokosc_dfs(wierzcholek,0);
		}
		function glebokosc_grafu(wierzcholek)
		{
			return glebokosc_dfs(wierzcholek,0);
		}
		function rysuj_graf(wierzcholek)
		{
			document.getElementById("dane").innerHTML=document.getElementById('n').value;
			for(i=1;i<wierzcholek.length;i++)
				document.getElementById("dane").innerHTML+="<br>"+wierzcholek[i].rodzic;
				//console.log(wierzcholek[i].dziecko);
			szerokosc=szerokosc_grafu(wierzcholek);
			glebokosc=glebokosc_grafu(wierzcholek);
			rysuj_dfs(wierzcholek,0,szerokosc,glebokosc,1);
			ctx=document.getElementById("canvas").getContext("2d");
			ctx.clearRect(0,0,c_width,c_height);
			ctx.fillStyle='blue';
			ctx.font="bold 15px Courier";
			for(i=1;i<wierzcholek.length;i++)
			{
				ctx.beginPath();
				ctx.strokeStyle="black";
				ctx.lineWidth="1";
				ctx.moveTo(wierzcholek[i].x*c_width/szerokosc,wierzcholek[i].y*c_height/(glebokosc+1));
				ctx.lineTo(wierzcholek[wierzcholek[i].rodzic].x*c_width/szerokosc,wierzcholek[wierzcholek[i].rodzic].y*c_height/(glebokosc+1));
				ctx.stroke();
			}
			for(i=0;i<wierzcholek.length;i++)
				ctx.fillText(i,wierzcholek[i].x*c_width/szerokosc,wierzcholek[i].y*c_height/(glebokosc+1));
		}
	</script>
  </head>
  <body>
  	<div class="opcje">
	  	<form onsubmit="rysuj_graf(drzewo(document.getElementById('n').value,drzewo(document.getElementById('n').value)));return false;">
	  		<table>
	  			<tbody>
	  				<tr>
	  					<td>Ilość wierzchołków</td>
	  					<td><input id="n" type="number" min="1" max="100" value="5"/></td>
	  				</tr>
	  			</tbody>
	  		</table>
	  		<br>
		  	<input type="submit" value="Generuj"/>
	  	</form>
  	</div>
  	<div class="dana">
  		<br>
  		<canvas id="canvas"></canvas>
  		<div id="dane">
  		</div>
  		<div class="dane">
  			Dane:
  			n - liczba wierzchołków<br>
  			<br>
  			kolejne n-1 wierszy to informacje o rodzicach<br>
  			<br>
  			w i-tym wierszu znajduje się rodzic wierzchołka o numerze i <nobr>(numeracja wierzchołków od 0 do n-1)</nobr><br>
  			<br>
  			wierzchołek 0 jest korzeniem
  		</div>
  	</div>
  </body>
</html>
